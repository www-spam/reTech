{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>재테크</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');
        .wrap {
            position: relative;
            width: 250px;
            padding: 10px;
        }
        .info {
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }
        .title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .close {
            position: absolute;
            top: 0;
            right: 0;
            cursor: pointer;
        }
        .img img {
            display: block;
            width: 100%;
        }
        .desc {
            font-size: 12px;
            color: #888;
            white-space: normal;
        }
        .info .close {
            position: absolute;
            top: 10px;
            right: 0px;
            color: #888;
            width: 24px;
            height: 24px;
            background: url('https://i.imgur.com/U8GACQQ.png');
        }

        .info .close:hover {
            cursor: pointer;
        }

    </style>
</head>
<body>
  <div style="width: 100%; height: 90px; left: 0px; top: 0px; right: 0px; background: #4A5D4C; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25)"></div>
  <!--글씨-->
  <div style="left: 30px; top: 20px; position: absolute; color: #FFF2AE; font-size: 55px; font-family: 'Nanum Gothic', sans-serif; font-weight: 700; word-wrap: break-word">재(再)테크
  </div>

  <div>
    <a href="{% url 'home' %}"><button class="darken-image-button" type="button" style="background: none; border: none; padding: 0; right: 30px; top: 25px; position: absolute; "><img src="https://i.imgur.com/IurDwvt.png" title="재로딩" alt="재로딩" style= "width: 55px; height: 55px; cursor: pointer;" /></button></a>
  </div>

  <div style="width: 1010px; height: 510px; left: 320px; top: 170px; z-index: 0; position: absolute; border: 5px solid #4A5D4C; /* 테두리 스타일 지정 */ border-radius: 10px;"></div>
  <!--z-index: 0; 다른 요소보다 뒤로 보내기-->
  <div id="map" style="width:1000px; height:500px; left: 330px; top: 180px; z-index: 0; position: absolute;">
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b1f7314c2e46a186abb6a8e391b620e3&libraries=services">
    </script>




  </div>

  <div> <!--전체-->
    <div class="background" style="width: 201px; height: 81px; left: 300px; top: 738px; position: absolute; background: #E4CCAA; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('리사이클링')"></div> <!--뒷 배경-->
    <div class="background" style="width: 201px; height: 81px; left: 300px; top: 730px; position: absolute; background: #F4DAB4; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('리사이클링')"></div> <!--윗 배경-->
    <div class="text" class="text darken-image-button" style="width: 175px; height: 55px; left: 313px; top: 760px; position: absolute; text-align: center; color: black; font-size: 22px; font-family: 'Nanum Gothic', sans-serif; font-weight: 500; word-wrap: break-word; cursor: pointer;" onclick="handleButtonClick('리사이클링')">리사이클링</div> <!--글씨-->
  </div>

  <div>
    <div style="width: 201px; height: 81px; left: 580px; top: 738px; position: absolute; background: #E3DABE; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('제로웨이스트')"></div>
    <div style="width: 201px; height: 81px; left: 580px; top: 730px; position: absolute; background: #F2E9CC; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('제로웨이스트')"></div>
    <div style="width: 175px; height: 55px; left: 593px; top: 760px; position: absolute; text-align: center; color: black; font-size: 22px; font-family: 'Nanum Gothic', sans-serif; font-weight: 500; word-wrap: break-word; cursor: pointer;" onclick="handleButtonClick('제로웨이스트')">제로웨이스트</div>
  </div>

  <div>
    <div style="width: 201px; height: 81px; left: 860px; top: 738px; position: absolute; background: #AEB794; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('네프론')"></div>
    <div style="width: 201px; height: 81px; left: 860px; top: 730px; position: absolute; background: #BEC8A3; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('네프론')"></div>
    <div style="width: 175px; height: 55px; left: 873px; top: 760px; position: absolute; text-align: center; color: black; font-size: 22px; font-family: 'Nanum Gothic', sans-serif; font-weight: 500; word-wrap: break-word; cursor: pointer;" onclick="handleButtonClick('네프론')">네프론</div>
  </div>

  <div>
    <div style="width: 201px; height: 81px; left: 1140px; top: 738px; position: absolute; background: #8C9D70; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('재활용센터')"></div>
    <div style="width: 201px; height: 81px; left: 1140px; top: 730px; position: absolute; background: #9AAC7B; border-radius: 50px; cursor: pointer;" onclick="handleButtonClick('재활용센터')"></div>
    <div style="width: 175px; height: 55px; left: 1153px; top: 760px; position: absolute; text-align: center; color: black; font-size: 22px; font-family: 'Nanum Gothic', sans-serif; font-weight: 500; word-wrap: break-word; cursor: pointer;" onclick="handleButtonClick('재활용센터')">재활용센터</div>
  </div>


    <script>
var imageSrc = 'https://i.imgur.com/0lVyPVQ.png', // 마커이미지의 주소입니다
    imageSize = new kakao.maps.Size(32, 50), // 마커이미지의 크기입니다
    imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
    var markerImg = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);



if (navigator.geolocation) {

    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
    navigator.geolocation.getCurrentPosition(function(position) {

        var lat = position.coords.latitude, // 위도
            lon = position.coords.longitude; // 경도

        var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
            message = '<div style="padding:5px;">현 위치</div>'; // 인포윈도우에 표시될 내용입니다

        // 마커와 인포윈도우를 표시합니다
        menowMarker(locPosition, message);

      });

} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

    var locPosition = new kakao.maps.LatLng(33.450701, 126.570667),
        message = 'geolocation을 사용할수 없어요..'

    menowMarker(locPosition, message);
}

// 지도에 마커와 인포윈도우를 표시하는 함수입니다
function menowMarker(locPosition, message) {

    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        map: map,
        position: locPosition,
        image: markerImg
    });

    var iwContent = message, // 인포윈도우에 표시할 내용
        iwRemoveable = true;

    // 인포윈도우를 생성합니다
    var infowindow = new kakao.maps.InfoWindow({
        content : iwContent,
        removable : iwRemoveable
    });

    // 인포윈도우를 마커위에 표시합니다
    infowindow.open(map, marker);

    // 지도 중심좌표를 접속위치로 변경합니다
    map.setCenter(locPosition);
}




    var mapcontainer = document.getElementById('map');
        var mapoptions = {
           center: new kakao.maps.LatLng(33.450701, 126.570667),
           level: 8
        };
        var map = new kakao.maps.Map(mapcontainer, mapoptions);


        var ps = new kakao.maps.services.Places();
        var centers = JSON.parse("{{ centerJson|escapejs }}");
    console.log(centers)



    var positions = [];
for (var i = 0; i < Object.keys(centers).length; i++) {
  var content = {
    title: centers[i].title,
    latlng: new kakao.maps.LatLng(centers[i].mapx, centers[i].mapy),
    addr1: centers[i].addr1,
    addr2: centers[i].addr2,

    tel: centers[i].tel,
    info: centers[i].info,
  };
  positions.push(content);
}
console.log(positions);

// 마커 이미지의 이미지 주소입니다
var imageSrc = "https://i.imgur.com/JceOLsg.png";

// Initialize overlayArray
var overlayArray = [];

// Loop through the positions array to create markers and overlays
for (var i = 0; i < positions.length; i++) {
  var imageSize = new kakao.maps.Size(32, 50);
  var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

  // Create marker
  var marker = new kakao.maps.Marker({
    map: map,
    position: positions[i].latlng,
    title: positions[i].title,
    image: markerImage,
  });

  (function (marker, place) {
    kakao.maps.event.addListener(marker, 'click', function () {
      closeAllOverlays(); // Close all overlays when another marker is clicked
      var overlayContent =
        '<div class="wrap">' +
        '    <div class="info">' +
        '        <div class="title">' +
        place.title +
        '<div class="close" onclick="closeOverlay()" title="Close"></div>' +
        '        </div>' +
        '        <div class="body">' +

        '            <div class="desc">' +
        '                <div class="ellipsis">' + place.addr1 + '</div>' +
        '                <div class="ellipsis">' + ' (지번) ' + place.addr2 + '</div>' +
        '                <div class="ellipsis">' +' (주요취급품목정보) '+ place.info + '</div>' +
        '		       <div class="jibun ellipsis">'+' (전화번호) ' + place.tel + '</div>' +
        '            </div>' +
        '        </div>' +
        '    </div>' +
        '</div>';




      var overlay = new kakao.maps.CustomOverlay({
        content: overlayContent,
        map: map,
        position: marker.getPosition(),
      });

      // Close overlay when map is clicked
      kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
        overlay.setMap(null);
      });

      overlayArray.push(overlay); // Add the custom overlay to the array
    });
  })(marker, positions[i]);
}

function closeAllOverlays() {
  for (var i = 0; i < overlayArray.length; i++) {
    overlayArray[i].setMap(null); // Close all overlays
  }
  overlayArray = []; // Reset the array
}

function handleButtonClick(name) {
    if (name === '리사이클링') {
        window.location.href = "{% url 'recycling_market' %}";
    } else if (name === '제로웨이스트') {
        window.location.href = "{% url '0_waste' %}";
    } else if (name === '네프론') {
        window.location.href = "{% url 'nephron' %}";
    } else if (name === '재활용센터') {
        window.location.href = "{% url 'recycling_center' %}";
    }
}



    </script>



<div style="position: fixed; left: 20px; bottom: 18px;">
    <a href="{% url 'mini_game' %}"><button class= "darken-image-button" type="button" style="background: none; border: none; padding: 0;"><img style="width: 140px; height: 120px; cursor: pointer;" title= "미니게임" alt="미니게임" src="https://i.imgur.com/j8qIp8G.png" /></button></a>
</div>
<div style="position: fixed; right: 20px; bottom: 20px;"> 
    <a href="{% url 'chatbot' %}"><button class= "darken-image-button" type="button" id="show" style="background: none; border: none; padding: 0;"><img style="width: 100px; height: 100px; cursor: pointer;" title= "챗봇" alt="챗봇" src="https://i.imgur.com/ce1hnH5.png" /></button></a>
</div>
</body>
</html>